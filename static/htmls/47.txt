<h1>python爬取头像和网名，并存入sqlite数据库</h1><p>头像大全：http://www.touxiang.cn/&nbsp;网名生成器：http://www.qmsjmfb.com/</p><p>&nbsp;</p><ul><li>环境： win7 python2.7</li><li>工具：pycharm SQLiteStudio</li></ul><p>&nbsp;</p><p>其实原本是要爬取百度图片的，但发现百度图片页面是通过js加载出来的，所以没有深究，头像大全的网址是师哥赵提供的，静态页面非常好抓，图片也很全。缺点是图片加载比较慢</p><p>&nbsp;</p><p>主要记一下这一天里卡住的几个地方吧</p><ul><li>SQLite第一次接触，主要通过这两个网址学习和熟悉</li><li class="ql-indent-1"><a href="http://www.runoob.com/sqlite/sqlite-tutorial.html" target="_blank">菜鸟教程</a></li><li class="ql-indent-1"><a href="https://www.oschina.net/question/12_53183" target="_blank">一个小时内学习sqlite</a></li><li class="ql-indent-1">安装过程：将sqlite.exe所在<strong>文件夹</strong>的路径加入系统变量path里，而不是sqlite.exe的路径</li><li class="ql-indent-1">安装、配置完成后，竟然找不到数据库的位置，后来得知创建的数据库没有固定的位置，在哪个路径下执行<span style="background-color: rgb(235, 241, 221);">sqlite3 db名称 </span>，数据库就被创建在哪个路径下</li><li class="ql-indent-1">编辑器显示中文：<span style="background-color: rgb(235, 241, 221);">#coding:utf8</span></li><li class="ql-indent-1">从txt中读出的中文数据乱码，要将txt的编码格式改为utf-8</li><li class="ql-indent-1">指定sqlite编码方式：<span style="background-color: rgb(235, 241, 221);">conn.text_factory = 'utf-8'</span></li><li class="ql-indent-1"><span style="background-color: rgb(235, 241, 221);">if typeText in type: </span>执行这句时报警告，意思是unicode 和 utf-8 无法比较。应该在中文串前加u。<span style="background-color: rgb(235, 241, 221);">type = [u'清新',u'可爱QQ头像',u'唯美',u'风景',u'萌',u'时尚']</span></li><li>安装sqlite遇到的问题</li><li>windows下安装BeautifulSoup：直接执行 <span style="background-color: rgb(235, 241, 221);">pip install bs4</span>。(不知道pip install beautifulsoup是否起了作用，但是在install bs4之后才可以<span style="background-color: rgb(235, 241, 221);">import bs4</span>)</li><li>python全局变量</li><li>python函数又忘了，每次遇到都现查：<span style="background-color: rgb(235, 241, 221);">def functionname():</span></li><li>编码问题</li></ul><p>&nbsp;&nbsp;&nbsp;</p><ul><li><span style="background-color: rgb(235, 241, 221);">conn.execute("insert into name(id,name) values(?,?)", (id, line,))</span>这里卡了半天，不知道为啥要加一个句号，总之加上就对了</li></ul><p>&nbsp;</p><p>&nbsp;</p><p>以下是源码</p><ul><li>爬头像</li></ul><p>&nbsp;</p><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large">  #coding:utf8</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> import urllib2</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> from bs4 import BeautifulSoup</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> import sqlite3</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> def geturl(url,id):</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;response = urllib2.urlopen(url)</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;soup1 = BeautifulSoup(response, "html.parser")</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;groupNodes = soup1.find_all('a', class_='img')</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;for groupNode in groupNodes:</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupurl = groupNode['href']</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupurl = '</span><a href="http://www.touxiang.cn/" target="_blank" style="background-color: rgb(187, 187, 187);" class="ql-size-large">http://www.touxiang.cn/</a><span style="background-color: rgb(187, 187, 187);" class="ql-size-large">' + groupurl</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response = urllib2.urlopen(groupurl)</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;soup2 = BeautifulSoup(response, "html.parser")</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;imgNodes = soup2.find('div', class_='artCon').find_all('img')</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for imgNode in imgNodes:</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id = id + 1</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;imgurl = imgNode['src']</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# print ":", imgurl</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# conn.execute("insert into name(id,name) values(2,'yoyo')")</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.execute("insert into avatar2(id,url) values(?,?)", (id, imgurl,))</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print typeText, ':', imgurl,'写表完成。id是',id</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;return id</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> </span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> id = 0</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> conn = sqlite3.connect('userdata.db')</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> type = [u'清新',u'可爱QQ头像',u'唯美',u'风景',u'萌',u'时尚']</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> #u'文艺',u'温暖',u'青春'这三类暂时没有-------------------------------------todo</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> response = urllib2.urlopen("http://www.touxiang.cn/Special/")</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> soup = BeautifulSoup(response,"html.parser")</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> typeNodes = soup.find_all('a',class_='cBrown')</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> </span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> for typeNode in typeNodes:</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;typeText = typeNode.get_text()</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;if typeText in type:</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url = typeNode['href']</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print typeText,":",url</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url2 = url + '/index_2.html'</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id = geturl(url, id)</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id = geturl(url2, id)</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> </span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> conn.commit()</span></h5><h5><span style="background-color: rgb(187, 187, 187);" class="ql-size-large"> conn.close()</span></h5><p>  </p><p>&nbsp;</p><ul><li>爬名字</li></ul><p>&nbsp;</p><p>  <span style="background-color: rgb(235, 241, 221);">########################################</span></p><p><span style="background-color: rgb(235, 241, 221);"> # ----------------------------craw name-----------------</span></p><p><span style="background-color: rgb(235, 241, 221);"> import urllib2</span></p><p><span style="background-color: rgb(235, 241, 221);"> from bs4 import BeautifulSoup</span></p><p><span style="background-color: rgb(235, 241, 221);"> import sqlite3</span></p><p><span style="background-color: rgb(235, 241, 221);"> conn = sqlite3.connect('userdata.db')</span></p><p><span style="background-color: rgb(235, 241, 221);"> id = 9779</span></p><p><span style="background-color: rgb(235, 241, 221);"> for i in range(0,100):</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;response = urllib2.urlopen("http://www.qmsjmfb.com/")</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;soup = BeautifulSoup(response)</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;names = soup.find('div',class_ = 'name_box').find('ul',class_ = 'name_show').find_all('li')</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;for name in names:</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id = id + 1</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_text =&nbsp;name.get_text()</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# conn.execute("insert into name(id,name) values(2,'yoyo')")</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.execute("insert into name(id,name) values(?,?)",(id,name_text,))</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print id,':',name_text</span></p><p><span style="background-color: rgb(235, 241, 221);"> </span></p><p><span style="background-color: rgb(235, 241, 221);"> conn.commit()</span></p><p><span style="background-color: rgb(235, 241, 221);"> conn.close()</span></p><p>  </p><p>&nbsp;</p><ul><li>将txt数据db</li></ul><p>&nbsp;</p><p>  <span style="background-color: rgb(235, 241, 221);">############################</span></p><p><span style="background-color: rgb(235, 241, 221);"> #---------------------read file-------------------------------</span></p><p><span style="background-color: rgb(235, 241, 221);"> import sqlite3</span></p><p><span style="background-color: rgb(235, 241, 221);"> conn = sqlite3.connect('userdata.db')</span></p><p><span style="background-color: rgb(235, 241, 221);"> conn.text_factory = 'utf-8'</span></p><p><span style="background-color: rgb(235, 241, 221);"> id = 98679</span></p><p><span style="background-color: rgb(235, 241, 221);"> for line in open("d:/name.txt"):</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;id = id + 1</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;print id,":",line</span></p><p><span style="background-color: rgb(235, 241, 221);"> &nbsp;&nbsp;&nbsp;conn.execute("insert into name(id,name) values(?,?)", (id, line,))</span></p><p><span style="background-color: rgb(235, 241, 221);"> conn.commit()</span></p><p><span style="background-color: rgb(235, 241, 221);"> conn.close()</span></p><p>  </p><p>&nbsp;</p><ul><li>一些参考代码</li></ul><p>&nbsp;</p><p>  <span style="background-color: rgb(235, 241, 221);">##########################</span></p><p><span style="background-color: rgb(235, 241, 221);"> # ---------------reference--------------------------------</span></p><p><span style="background-color: rgb(235, 241, 221);"> # about sqlite3</span></p><p><span style="background-color: rgb(235, 241, 221);"> # import sqlite3</span></p><p><span style="background-color: rgb(235, 241, 221);"> # conn = sqlite3.connect('userdata.db')</span></p><p><span style="background-color: rgb(235, 241, 221);"> </span></p><p><span style="background-color: rgb(235, 241, 221);"> # conn.execute('''create table name(id int primary key, name char)''')</span></p><p><span style="background-color: rgb(235, 241, 221);"> # conn.execute("insert into name(id,name) values(1,'yoyo')")</span></p><p><span style="background-color: rgb(235, 241, 221);"> # names = conn.execute("select id,name from name")</span></p><p><span style="background-color: rgb(235, 241, 221);"> # for row in names:</span></p><p><span style="background-color: rgb(235, 241, 221);"> #&nbsp;&nbsp;&nbsp;&nbsp;print 'id:',row[0]</span></p><p><span style="background-color: rgb(235, 241, 221);"> #&nbsp;&nbsp;&nbsp;&nbsp;print 'name:',row[1]</span></p><p><span style="background-color: rgb(235, 241, 221);"> # conn.commit()</span></p><p><span style="background-color: rgb(235, 241, 221);"> # print "Table created successfully"</span></p><p><span style="background-color: rgb(235, 241, 221);"> #</span></p><p><span style="background-color: rgb(235, 241, 221);"> # conn.close()</span></p><p>  </p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>